{% extends "base.html" %}

{% block header_class %}banner overlay bg-cover{% endblock %}
{% block header_attrs %}data-background="/static/images/banner.jpg"{% endblock %}
{% block nav_class %}navbar-dark{% endblock %}

{% block banner %}
<div class="container section">
	<div class="row">
		<div class="col-lg-8 text-center mx-auto">
			<h1 class="text-white mb-3">Smart insight &amp; One search</h1>
			<p class="text-white mb-4">See what analysts are saying, all in one place</p>
			<div class="position-relative">
				<form action="/data.html" method="get">
					<input id="search" name="q" class="form-control"
						placeholder="Have a question? Just ask here or enter terms">
					<i class="ti-search search-icon"></i>
				</form>
			</div>
		</div>
	</div>
</div>
{% endblock %}


{% block content %}
<!-- topics -->
<section class="section">
	<div class="container">
		<div class="row justify-content-center">
			<div class="col-12 text-center">
				<h2 class="section-title">Recent Analyst Reports</h2>
			</div>
			<div class="col-12">
				<table class="table table-hover">
					<thead>
						<tr>
							<th scope="col">Date</th>
							<th scope="col">Stock Name</th>
							<th scope="col">Ticker</th>
							<th scope="col">Analyst</th>
							<th scope="col">Expert Firm</th>
							<th scope="col">Expected Return</th>
							<th scope="col">Rating</th>
						</tr>
					</thead>
					<tbody>
						{% for report in reports %}
						<tr>
							<td>{{ report.written_date }}</td>
							<td>
								<a href="/data.html?q={{ report.stock.stock_name }}">{{ report.stock.stock_name }}</a>
							</td>
							<td>{{ report.stock.stock_code }}</td>
							<td>{{ report.author.name if report.author else '-' }}</td>
							<td>{{ report.broker.name if report.broker else '-' }}</td>
							{% set expected_return = ((report.fair_price - report.stock.current_price) /
							report.stock.current_price * 100) if (report.fair_price and report.stock.current_price) else
							None %}
							<td
								class="{{ 'text-danger' if expected_return and expected_return > 0 else 'text-primary' if expected_return and expected_return < 0 else '' }}">
								{{ "{:+.2f}%".format(expected_return) if expected_return is not none else '-' }}
							</td>
							<td
								class="{{ 'text-danger' if report.rating_code == 'Buy' else 'text-primary' if report.rating_code == 'Sell' else '' }}">
								{{ report.rating_code }}
							</td>
						</tr>
						{% endfor %}
					</tbody>
				</table>
			</div>
		</div>
	</div>
</section>
<!-- /topics -->

<!-- call to action -->
<section>
	<div class="container">
		<div class="row">
			<div class="col-12">
				<div class="section px-3 bg-white shadow text-center">
					<h2 class="mb-4">Please evaluate our website!</h2>
					<p class="mb-4">We have imporved the Korea Economic Daily consensus(Hankyung) Please use the Form to
						evaluate our service!</p>
					<a href="https://docs.google.com/forms/d/e/1FAIpQLSfSK4KNORZEKcA-e5lWlZ-6rWWQbv8-FYdFSyPuvQdtyLGh9Q/viewform?usp=dialog"
						class="btn btn-primary">Evaluation Form</a>
				</div>
			</div>
		</div>
	</div>
</section>
<!-- /call to action -->
{% endblock %}